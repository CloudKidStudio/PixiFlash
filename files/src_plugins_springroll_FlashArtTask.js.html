<!DOCTYPE html>
<html lang='en'>
<head>
	<title>Pixi Flash v0.1.0 API Documentation : src/plugins/springroll/FlashArtTask.js</title>
	<meta charset='utf-8'>
	<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
	<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>
	<link rel='shortcut icon' type='image/png' href='../assets/images/favicon.ico?v=0.1.0'>
	<link href='//fonts.googleapis.com/css?family=Titillium+Web:300,200,600' rel='stylesheet' type='text/css'>
	<link rel='stylesheet' type='text/css' href='../assets/css/libraries.css?v=0.1.0'>
	<link rel='stylesheet' type='text/css' href='../assets/css/main.css?v=0.1.0'>
</head>
<body>
<header>
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class='container'>
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#docs-navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href='https://github.com/SpringRoll/PixiFlash'>
						<img src='../assets/images/logo.png?v=0.1.0' class="logo">
					<span class='project-name'>Pixi Flash</span>
					<span class="sr-only">API Documentation for:</span>
					<span class='version hidden-xs'>v0.1.0</span>
				</a>
			</div>
			<div class="collapse navbar-collapse" id="docs-navbar">
	      <ul class="scope-toggles text-center nav navbar-nav navbar-right">
					<li><input class='scope-toggle' 
						id='toggle-inherited' 
						type='checkbox' 
						data-toggle='toggle' 
						data-on='Inherited' 
						data-off='Inherited' 
						data-size='mini'
						data-width='80'>
					</li>
					<li><input class='scope-toggle' 
						id='toggle-protected' 
						type='checkbox' 
						data-toggle='toggle' 
						data-on='Protected' 
						data-off='Protected' 
						data-size='mini'
						data-width='80'>
					</li>
					<li><input class='scope-toggle' 
						id='toggle-private' 
						type='checkbox' 
						data-toggle='toggle' 
						data-on='Private' 
						data-off='Private' 
						data-size='mini'
						data-width='80'>
					</li>
					<li><input class='scope-toggle' 
						id='toggle-deprecated' 
						type='checkbox' 
						data-toggle='toggle' 
						data-on='Deprecated' 
						data-off='Deprecated' 
						data-size='mini'
						data-width='80'>
					</li>
				</ul>
			</div>
		</div>
	</nav>
</header>
<div class='container'>
<div class='row'>
<nav id='sidebar' class='col-sm-4 col-md-3'>
<h2>APIs</h2>
<div class='input-group'>
  <div class='input-group-addon'>
    <span class='glyphicon glyphicon-search'></span>
  </div>
  <input type='search' class='form-control' id='api-filter' placeholder='Type to filter APIs'>
  <span class='collapsed btn-close glyphicon glyphicon-remove-sign hidden'></span>
</div>
<nav class='navbar navbar-default'>
  <!-- Brand and toggle get grouped for better mobile display -->
  <div class="btn-group" role="group" aria-label="...">
    <button type="button" class="sidebar-toggle collapsed btn btn-default" id='toggle-classes' data-target='#classes-collapse'>
      Classes
      <span class='collapsed glyphicon glyphicon-chevron-up'></span>
      <span class='expanded glyphicon glyphicon-chevron-down'></span>
    </button>
    <button type="button" class="sidebar-toggle collapsed btn btn-default" id='toggle-modules' data-target='#modules-collapse'>
      Modules
      <span class='collapsed glyphicon glyphicon-chevron-up'></span>
      <span class='expanded glyphicon glyphicon-chevron-down'></span>
    </button>
  </div>

  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class='collapse' id='classes-collapse'>
    <ul class='nav navbar-nav'>
        <li class='public'>
          <a href='../classes/pixiflash.Bitmap.html'>pixiflash.Bitmap</a>
        </li>
        <li class='public'>
          <a href='../classes/pixiflash.Container.html'>pixiflash.Container</a>
        </li>
        <li class='private'>
          <a href='../classes/pixiflash.FlashArt.html'>pixiflash.FlashArt</a>
        </li>
        <li class='private'>
          <a href='../classes/pixiflash.FlashArtTask.html'>pixiflash.FlashArtTask</a>
        </li>
        <li class='public'>
          <a href='../classes/pixiflash.MovieClip.html'>pixiflash.MovieClip</a>
        </li>
        <li class='private'>
          <a href='../classes/pixiflash.MovieClipPlugin.html'>pixiflash.MovieClipPlugin</a>
        </li>
        <li class='public'>
          <a href='../classes/pixiflash.utils.html'>pixiflash.utils</a>
        </li>
    </ul>
  </div>

  <!-- Collect the nav links, forms, and other content for toggling -->
  <div class='collapse' id='modules-collapse'>
    <ul class='nav navbar-nav'>
        <li class=''>
          <a href='../modules/Pixi Flash.html'>Pixi Flash</a>
        </li>
        <li class=''>
          <a href='../modules/SpringRoll Plugin.html'>SpringRoll Plugin</a>
        </li>
    </ul>
  </div>
  <!-- /.container-fluid -->
</nav></nav>
<div class='col-sm-8 col-md-9'>
<div id='docs-main' class='apidocs'>
<h1 class="file-heading">File:FlashArtTask.js</h1>

<div class="file">
<pre class="code prettyprint linenums">/**
 * @module SpringRoll Plugin
 * @namespace pixiflash
 * @requires Pixi Flash
 */
(function()
{	
	var Task = include(&#x27;springroll.Task&#x27;),
		FlashArt = include(&#x27;pixiflash.FlashArt&#x27;),
		Application = include(&#x27;springroll.Application&#x27;),
		TextureAtlas = include(&#x27;springroll.pixi.TextureAtlas&#x27;),
		Texture = include(&#x27;PIXI.Texture&#x27;);

	/**
	 * Replaces Bitmaps in the global lib dictionary with a faux Bitmap
	 * that pulls the image from a spritesheet.
	 * @class FlashArtTask
	 * @extends springroll.Task
	 * @constructor
	 * @private
	 * @param {Object} asset The data properties
	 * @param {String} asset.type Asset type must be &quot;pixi&quot;
	 * @param {String} asset.format Asset format must be &quot;pixiflash.FlashArt&quot;
	 * @param {String} asset.src The source
	 * @param {Array} asset.images An array of Image, TextureAtlas, or SpriteSheet assets to load
	 * @param {Boolean} [asset.cache=false] If we should cache the result
	 * @param {String} [asset.id] Id of asset
	 * @param {Function} [asset.complete] The event to call when done
	 * @param {Object} [asset.sizes=null] Define if certain sizes are not supported
	 */
	var FlashArtTask = function(asset)
	{
		Task.call(this, asset, asset.src);

		/**
		 * The path to the flash asset
		 * @property {String} src
		 */
		this.src = this.filter(asset.src);
		
		/**
		 * Any image, atlas, or SpriteSheet assets that should be loaded along with this piece
		 * of flash art.
		 * @property {Array} images
		 */
		this.images = asset.images;

		/**
		 * The name of the window object library items hang on
		 * @property {String} libName
		 */
		this.libName = &quot;pixiflash_lib&quot;;
		
		/**
		 * The name of the window object images hang on
		 * @property {String} imagesName
		 */
		this.imagesName = &quot;pixiflash_images&quot;;
	};

	// Reference to prototype
	var p = FlashArtTask.prototype = Object.create(Task.prototype);

	/**
	 * Test if we should run this task
	 * @method test
	 * @static
	 * @param {Object} asset The asset to check
	 * @return {Boolean} If the asset is compatible with this asset
	 */
	FlashArtTask.test = function(asset)
	{
		return asset.src &amp;&amp;
			asset.src.search(/\.js$/i) &gt; -1 &amp;&amp;
			asset.type == &quot;pixi&quot; &amp;&amp;
			asset.format == &quot;pixiflash.FlashArt&quot; &amp;&amp;
			asset.images &amp;&amp; Array.isArray(asset.images);
	};

	/**
	 * Start the task
	 * @method  start
	 * @param  {Function} callback Callback when finished
	 */
	p.start = function(callback)
	{
		var images = [];
		var atlas, assetCount = 0;
		var asset;
		for(var i = 0; i &lt; this.images.length; ++i)
		{
			//check for texture atlases from TexturePacker or similar things
			if(this.images[i].atlas)
			{
				asset = this.images[i];
				atlas = {
					atlas:this.filter(asset.atlas),
					id: &quot;asset_&quot; + (assetCount++),
					type:&quot;pixi&quot;
				};
				if(asset.image)
					atlas.image = this.filter(asset.image);
				else
				{
					atlas.alpha = this.filter(asset.alpha);
					atlas.color = this.filter(asset.color);
				}
				images.push(atlas);
			}
			//Check for EaselJS SpriteSheets
			else if(this.images[i].format == &quot;createjs.SpriteSheet&quot;)
			{
				asset = this.images[i].clone();
				images.push(asset);
				if(!asset.type)
					asset.type = &quot;pixi&quot;;
				if(!asset.id)
					asset.id = &quot;asset_&quot; + (assetCount++);
			}
			//standard images
			else
			{
				//check for urls
				if(typeof this.images[i] == &quot;string&quot;)
					asset = {image:this.filter(this.images[i])};
				//and full tasks
				else
					asset = this.images[i].clone();
				//ensure an ID for these
				if(!asset.id)
				{
					var fallbackId = asset.src || asset.color;
					// Remove the file extension
					var extIndex = fallbackId.lastIndexOf(&#x27;.&#x27;);
					if (extIndex &gt; -1)
					{
						fallbackId = fallbackId.substr(0, extIndex);
					}
					// Check for the last folder slash then remove it
					var slashIndex = fallbackId.lastIndexOf(&#x27;/&#x27;);
					if (slashIndex &gt; -1)
					{
						fallbackId = fallbackId.substr(slashIndex + 1);
					}
					asset.id = fallbackId;
				}
				//also ensure that they are PIXI Texture assets
				asset.type = &quot;pixi&quot;;
				images.push(asset);
			}
		}
		
		var assets = {
			_flash : this.src
		};
		if(images.length)
			assets._images = {assets:images};

		// Load all the assets
		Application.instance.load(assets, function(results)
		{
			var art = new FlashArt(
				this.id,
				results._flash,
				this.libName
			);
			
			var images = results._images;
			if(images)
			{
				var image;
				var objectsToDestroy = [];
				var texturesToRemove = [];
				var globalImages = namespace(this.imagesName);
				
				for(var id in images)
				{
					var result = images[id];
					//save the item for cleanup
					objectsToDestroy.push(result);
					//look for individual images
					if(result instanceof Texture)
					{
						globalImages[id] = result;
						texturesToRemove.push(id);
					}
					else if(result instanceof TextureAtlas)
					{
						var frames = result.frames;
						for(var frame in frames)
						{
							globalImages[frame] = frames[frame];
							texturesToRemove.push(frame);
						}
					}
					//otherwise the result is a SpriteSheet
					else
					{
						//TODO: do something with spritesheet
					}
				}
				
				art._orig_destroy = art.destroy;
				art.destroy = function()
				{
					var i;
					for(i = objectsToDestroy.length - 1; i &gt;= 0; --i)
					{
						if(objectsToDestroy[i].destroy)
							objectsToDestroy[i].destroy();
						else
							objectsToDestroy[i].dispatchEvent(&quot;destroy&quot;);
					}
					for(i = texturesToRemove.length - 1; i &gt;= 0; --i)
					{
						delete globalImages[texturesToRemove[i]];
					}
					art._orig_destroy();
				};
			}
			
			callback(art);
			
		}.bind(this));
	};

	// Assign to namespace
	namespace(&#x27;pixiflash&#x27;).FlashArtTask = FlashArtTask;

}());</pre>
</div></div>
</div>
</div>
</div>
<script src='../assets/js/libraries.js?v=0.1.0'></script>
<script src='../assets/js/main.js?v=0.1.0'></script>
</body>
</html>